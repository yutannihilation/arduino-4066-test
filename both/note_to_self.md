# Note to self

## 回路

### TC74HC4066AP

4chアナログスイッチIC。なぜアナログスイッチICなのかというと、

* トランジスタ： 流れている電流がよくわからないので、安全のため回路を分けたい、ということでボツ
* メカニカルリレー： こっちでもいいのかも。PWMで制御できる？という気がしたのでアナログスイッチICにした、気がする。

### Arduino:

pin 3: 4066 の C1 に接続、1つ目のスイッチをコントロールする
pin 5: 4066 の C2 に接続、2つ目のスイッチをコントロールする
pin 6: ON/OFF を読み取る

安全装置の問題があるので、pin 3とpin5は交互にオンにしていく

## oneshot / burst

実際に回路をオンにしてから火花が出るまで 400〜500ms ほど？ラグ（たぶん充電）があるので、
正確に1発だけ鳴らすということが難しい。なので、

1. pin 6 がオンになってから 480ms 以内にオフになる → 1回だけ鳴るまではスイッチをオンのまま維持し、1回鳴ったらオフに
2. それ以上オンのまま → pin 6がオフに鳴るまでスイッチもオンのまま（つまり火花は連続で出続ける）

という挙動にする。ただし実際にはばらつきがあるので 1. は2回以上になったり0回だったりする。

## その他

### PWM（`analogWrite()`） ？

* 〜100くらい： 火花出ない
* 105〜115くらい： 火花は出始めるが、連発が通常より遅い
* それ以上： 通常通り

ただ、`digitalWrite()`を`analogWrite()`に変えると安全装置にひっかかるような気がする。よくわからない。

### 電圧

#### 最大電圧は？

不明。

基本は3.3V（元の電池の電圧）だが、火花が出た直後？は一時的に電流が増えて 7V 程度まで上がるっぽい。
デジタルマルチメータで見える範囲なので、瞬間的にはもっと上がっているのかもしれない。
これがあるので、3〜5V程度で動作するICとかをつなぐのはちょっと不安。

#### かける電圧を変えると火花の間隔は変わる？

* 電圧を強くするのは、5V電源をつないでみたけど変化なさそうだった。
* 電圧を弱くすると、遅くなる。ただし、PWM と同じく、変化する範囲がかなり微妙なので狙ってコントロールするのは難しそう。

### 内部構造

* 中でもカチカチ音が鳴っているので、回路のどこかでメカニカルリレーが使われている気がする。たぶんコントロールする側の回路は電気的に分けたいからなんだろう。
